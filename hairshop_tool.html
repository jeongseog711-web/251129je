<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í—¤ì–´ì¼€ì–´ ì–´ì‹œìŠ¤í„´íŠ¸</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // === í•˜ì´ì—”ë“œ ì‚´ë¡± ì»¨ì…‰ì˜ Tailwind ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ===
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'salon-bg': '#EFECE7',       // ë°ì€ ë² ì´ì§€ (ë§ˆë¸” ì§ˆê°ì˜ ë°”íƒ•ìƒ‰)
                        'primary': '#1A3C4E',        // ë”¥ ë„¤ì´ë¹„ (ì£¼ìš” í…ìŠ¤íŠ¸, ë²„íŠ¼ ë°°ê²½)
                        'secondary': '#0A1C2A',      // ì œëª© í…ìŠ¤íŠ¸: ê±°ì˜ ê²€ì •ì— ê°€ê¹Œìš´ ë„¤ì´ë¹„
                        'accent-gold': '#A38853',    // ê³¨ë“œ/í™©ë™ (í¬ì¸íŠ¸ ìƒ‰ìƒ)
                        'card-white': '#FFFFFF',     // ì¹´ë“œ ë°°ê²½: í°ìƒ‰
                        'danger': '#B91C1C',         // ìœ„í—˜ ìš”ì†Œ
                        'info-subtle': '#F9FAFB',    // ì •ë³´ ë°°ê²½
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° Inter í°íŠ¸ ì ìš© */
        body { font-family: 'Inter', sans-serif; }
        
        /* ë°°ê²½ìƒ‰ ë³€ê²½: ì€ì€í•œ ë§ˆë¸” í…ìŠ¤ì²˜ ëŠë‚Œ */
        .bg-body { 
            background-color: #EFECE7; 
            /* Subtle marble/texture overlay using CSS gradient for depth */
            background-image: radial-gradient(circle at center, #ffffff33 1px, transparent 1px), 
                              radial-gradient(circle at center, #00000011 1px, transparent 1px);
            background-size: 8px 8px;
        } 
        
        .card {
            background-color: var(--tw-bg-card-white);
            border-radius: 1.5rem; /* ë” ë‘¥ê¸€ê²Œ */
            /* ê·¸ë¦¼ì ê°•í™”: ê³ ê¸‰ìŠ¤ëŸ¬ìš´ 3D ë¶€ê° íš¨ê³¼ */
            box-shadow: 0 20px 25px -10px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.08);
            border: 1px solid #F3F4F6;
        }
        
        .scroll-container { max-height: 50vh; overflow-y: auto; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• (ì•¡ì„¼íŠ¸ ê³¨ë“œ ìƒ‰ìƒ ì ìš©) */
        .scroll-container::-webkit-scrollbar { width: 8px; }
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: var(--tw-bg-accent-gold);
            border-radius: 10px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background-color: #F5F5F4;
            border-radius: 10px;
        }

        /* ê³¨ë“œ ìƒ‰ìƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-gold {
            background-color: var(--tw-bg-accent-gold);
            color: white;
            transition: all 0.2s;
        }
        .btn-gold:hover {
            background-color: #8C754D; /* ì•½ê°„ ì–´ë‘ìš´ ê³¨ë“œ */
            box-shadow: 0 4px 6px -1px rgba(163, 136, 83, 0.4), 0 2px 4px -2px rgba(163, 136, 83, 0.2);
        }
        
        /* === í˜ì´ì§€ ì „í™˜ì„ ìœ„í•œ CSS í´ë˜ìŠ¤ === */
        /* ê¸°ë³¸ í˜ì´ì§€ ì»¨í…Œì´ë„ˆ: ì ˆëŒ€ ìœ„ì¹˜ë¡œ ì˜¤ë²„ë ˆì´ ê°€ëŠ¥í•˜ê²Œ ì„¤ì • */
        .page-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
        }

        /* í˜„ì¬ í˜ì´ì§€ê°€ ì•„ë‹ ë•Œì˜ ìŠ¤íƒ€ì¼ (ìŠ¬ë¼ì´ë“œ & í˜ì´ë“œ) */
        .page-hidden {
            opacity: 0;
            transform: translateX(50px); /* ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚´ì§ ë°€ì–´ ìˆ¨ê¹€ */
            pointer-events: none;
            display: none; /* ì „í™˜ í›„ ì™„ì „íˆ ìˆ¨ê²¨ì„œ ë ˆì´ì•„ì›ƒ ì˜í–¥ ì œê±° */
        }
        
        /* í˜„ì¬ í˜ì´ì§€ì¼ ë•Œì˜ ìŠ¤íƒ€ì¼ */
        .page-visible {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            display: block;
        }

    </style>
</head>
<body class="bg-body min-h-screen p-4 sm:p-8">

    <!-- Firebase SDK Imports (ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase ì„¤ì • (ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-haircare-app-id';

        // ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ë””ë²„ê·¸ ë¡œê¹… í™œì„±í™”
        setLogLevel('Debug');

        let currentUserId = null;

        // UI ìš”ì†Œ
        const loadingEl = document.getElementById('loading-state');
        const appContainer = document.getElementById('app-container');
        const userIdDisplay = document.getElementById('user-id-display');
        const recordsList = document.getElementById('records-list');
        const diagnosisResult = document.getElementById('diagnosis-result');
        const recommendationList = document.getElementById('recommendation-list');
        const reminderLog = document.getElementById('reminder-log');

        const clientNameInput = document.getElementById('client-name');
        const scalpTypeInput = document.getElementById('scalp-type');
        const lastServiceDateInput = document.getElementById('last-service-date');
        
        // í˜ì´ì§€ ìš”ì†Œ
        const pageMain = document.getElementById('page-main');
        const pageCrm = document.getElementById('page-crm');


        // Firestore ê²½ë¡œ ì„¤ì •
        const getCollectionRef = (userId) => {
             // ì‚¬ì„¤ ë°ì´í„° ê²½ë¡œ: /artifacts/{appId}/users/{userId}/haircare_records
            return collection(db, 'artifacts', appId, 'users', userId, 'haircare_records');
        };

        // í˜ì´ì§€ ì „í™˜ ë¡œì§
        window.goToPage = (pageNumber) => {
            const transitionDuration = 400; // 0.4s
            
            if (pageNumber === 1) {
                // CRM í˜ì´ì§€ ìˆ¨ê¸°ê¸°
                pageCrm.classList.remove('page-visible');
                pageCrm.classList.add('page-hidden');
                
                // ë©”ì¸ í˜ì´ì§€ í‘œì‹œ
                pageMain.style.display = 'block'; // ë¨¼ì € ë³´ì—¬ì¤€ ë‹¤ìŒ íŠ¸ëœì§€ì…˜ ì‹œì‘
                setTimeout(() => {
                    pageMain.classList.remove('page-hidden');
                    pageMain.classList.add('page-visible');
                    // í•„ìš” ì‹œ ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ ì´ë™
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 50);

            } else if (pageNumber === 2) {
                // ë©”ì¸ í˜ì´ì§€ ìˆ¨ê¸°ê¸°
                pageMain.classList.remove('page-visible');
                pageMain.classList.add('page-hidden');
                
                // CRM í˜ì´ì§€ í‘œì‹œ
                pageCrm.style.display = 'block'; // ë¨¼ì € ë³´ì—¬ì¤€ ë‹¤ìŒ íŠ¸ëœì§€ì…˜ ì‹œì‘
                 setTimeout(() => {
                    pageCrm.classList.remove('page-hidden');
                    pageCrm.classList.add('page-visible');
                    // í•„ìš” ì‹œ ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ ì´ë™
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 50);
            }
        };

        // 1. ì¸ì¦ ë° Firestore ì´ˆê¸°í™”
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                userIdDisplay.textContent = currentUserId;
                loadingEl.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                // í˜ì´ì§€ 1ì„ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œí•˜ê³ , í˜ì´ì§€ 2ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬
                pageMain.classList.add('page-visible');
                pageCrm.classList.add('page-hidden');
                pageCrm.style.display = 'none'; // ì´ˆê¸° ë¡œë“œ ì‹œ CRM í˜ì´ì§€ ìˆ¨ê¸°ê¸°
                
                // Firestore ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
                setupFirestoreListener(currentUserId);
            } else {
                // ì¸ì¦ í† í°ì´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ ì‹œë„, ì—†ìœ¼ë©´ ìµëª… ë¡œê·¸ì¸
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("ì¸ì¦ ì‹¤íŒ¨:", error);
                    alertMessage("error", "ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    loadingEl.textContent = 'ì¸ì¦ ì˜¤ë¥˜: ì•±ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }
            }
        });

        // =========================================================================
        // ëª¨ì˜ ì œí’ˆ ìƒì„¸ ì •ë³´ (ì´ë¯¸ì§€ ë° ê°€ê²©)ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        const getProductDetails = (productName) => {
            const mockProducts = {
                "ê·¹ì†ìƒ ëª¨ë°œìš© ì§‘ì¤‘ ì˜ì–‘ ë§ˆìŠ¤í¬": {
                    image: `https://placehold.co/80x80/A38853/FFFFFF?text=Mask`, // Gold Accent
                    price: "58,000ì›"
                },
                "ê³ ë†ì¶• ë‹¨ë°±ì§ˆ ì„¸ëŸ¼": {
                    image: `https://placehold.co/80x80/1A3C4E/FFFFFF?text=Serum`, // Primary Dark
                    price: "42,000ì›"
                },
                "ë°ì¼ë¦¬ ì†ìƒ ì¼€ì–´ ìƒ´í‘¸ (pH ì•½ì‚°ì„±)": {
                    image: `https://placehold.co/80x80/6B7280/FFFFFF?text=Shampoo`, // Subtle Gray
                    price: "29,000ì›"
                },
                "ìˆ˜ë¶„ ê³µê¸‰ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸": {
                    image: `https://placehold.co/80x80/D1D5DB/000000?text=Treat`, // Light Gray
                    price: "35,000ì›"
                },
                "ì§€ì„± ë‘í”¼ ë”¥ í´ë Œì§• ìƒ´í‘¸": {
                    image: `https://placehold.co/80x80/1A3C4E/FFFFFF?text=Oily`,
                    price: "31,000ì›"
                },
                "ê±´ì„± ë‘í”¼ ë³´ìŠµ ì•°í”Œ": {
                    image: `https://placehold.co/80x80/A38853/FFFFFF?text=Dry`,
                    price: "65,000ì›"
                },
                "ë¯¼ê° ë‘í”¼ ì§„ì • í† ë‹‰": {
                    image: `https://placehold.co/80x80/0A1C2A/FFFFFF?text=Tone`,
                    price: "49,000ì›"
                },
                "ì»¬ëŸ¬ ìœ ì§€ë ¥ í–¥ìƒ ìƒ´í‘¸": {
                    image: `https://placehold.co/80x80/A38853/FFFFFF?text=Color`,
                    price: "33,000ì›"
                },
                "ì»¬ íƒ„ë ¥ ê°•í™” ì—ì„¼ìŠ¤": {
                    image: `https://placehold.co/80x80/1A3C4E/FFFFFF?text=Curl`,
                    price: "45,000ì›"
                }
            };
            return mockProducts[productName] || { image: "https://placehold.co/80x80/E5E5E5/999999?text=N/A", price: "ë¯¸ì •" };
        };
        // =========================================================================

        // =========================================================================
        // [í•µì‹¬ ë¡œì§] ì‹œìˆ  ì´ë ¥ ë° ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ëª¨ë°œ ì†ìƒë„ë¥¼ ì¶”ë¡ í•˜ëŠ” í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
        const inferDamageLevel = (services, lastServiceDate) => {
            let damage = 'none';

            // 1. ì‹œìˆ  ì¢…ë¥˜ ê¸°ë°˜ ì†ìƒë„ ê²°ì •
            if (services.includes('bleach')) {
                damage = 'severe'; // íƒˆìƒ‰ ì´ë ¥ì€ ì‹¬ê°í•œ ì†ìƒìœ¼ë¡œ ì¶”ì •
            } else if (services.includes('color') && (services.includes('perm') || services.includes('straightening'))) {
                damage = 'moderate'; // ì—¼ìƒ‰ê³¼ íŒì´ ê°™ì´ ìˆëŠ” ê²½ìš° ë³´í†µ ì†ìƒìœ¼ë¡œ ì¶”ì •
            } else if (services.includes('color') || services.includes('perm') || services.includes('straightening')) {
                damage = 'light'; // ì—¼ìƒ‰ ë˜ëŠ” íŒë§Œ ìˆëŠ” ê²½ìš° ê²½ë¯¸í•œ ì†ìƒìœ¼ë¡œ ì¶”ì •
            } else if (services.includes('clinic') && services.length > 1) {
                // í´ë¦¬ë‹‰ì„ ë‹¤ë¥¸ ì‹œìˆ ê³¼ í•¨ê»˜ ë°›ì•˜ë‹¤ë©´, ì´ì „ì— ì†ìƒì´ ìˆì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
                if (damage === 'none') damage = 'light';
            }


            // 2. ì‹œìˆ  ì‹œì  ê¸°ë°˜ ì†ìƒë„ ì¦í­ (í™”í•™ ì‹œìˆ  í›„ 30ì¼ ì´ë‚´ì¸ ê²½ìš°)
            if (lastServiceDate) {
                const lastDate = new Date(lastServiceDate);
                const today = new Date();
                const diffTime = Math.abs(today - lastDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const chemicalServices = ['perm', 'straightening', 'color', 'bleach'];
                const hasChemical = services.some(s => chemicalServices.includes(s));

                if (diffDays < 30 && hasChemical) {
                    if (damage === 'light') damage = 'moderate';
                    else if (damage === 'none') damage = 'light';
                }
            }

            return damage;
        };
        // =========================================================================


        // 2. ëª¨ì˜ AI ì§„ë‹¨ ë° ì¶”ì²œ ë¡œì§ (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
        const runAIDiagnosis = (clientName, scalpType, damageLevelPlaceholder, lastServiceTypes, lastServiceDate) => {
            
            // lastServiceTypesê°€ ë°°ì—´ì¸ì§€ í™•ì¸ (ë°©ì–´ì  ì½”ë“œ)
            const services = Array.isArray(lastServiceTypes) ? lastServiceTypes : [lastServiceTypes];

            // **ì‹œìˆ  ì´ë ¥ ë° ë‚ ì§œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì†ìƒë„ë¥¼ ì¶”ë¡ í•©ë‹ˆë‹¤.**
            const currentDamageLevel = inferDamageLevel(services, lastServiceDate);

            let riskAssessment = "í˜„ì¬ ëª¨ë°œ ìƒíƒœëŠ” ì–‘í˜¸í•˜ì—¬ ëª¨ë“  ì‹œìˆ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
            let possibleServices = "ì»·, ì—¼ìƒ‰, ì¼ë°˜ íŒ, ë§¤ì§ íŒ";
            let recommendedProducts = []; // ì„ì‹œë¡œ ì œí’ˆ ì´ë¦„(string)ë§Œ ì €ì¥

            // ëª¨ì˜ AI ë¡œì§ (ì¶”ë¡ ëœ ì†ìƒë„ currentDamageLevel ì‚¬ìš©)
            
            if (currentDamageLevel === 'severe') {
                riskAssessment = "ëª¨ë°œ ì†ìƒë„ê°€ ì‹¬ê°í•˜ì—¬ ì—¼ìƒ‰/íƒˆìƒ‰/íŒ ì‹œìˆ ì€ **ë§¤ìš° ìœ„í—˜**í•˜ë©° ë‹¤ìŒ ë°©ë¬¸ì„ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤. ì‹œìˆ  ì‹œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                possibleServices = "ëª¨ë°œ í´ë¦¬ë‹‰ (ê·¹ì†ìƒìš©), ë‘í”¼ ì§„ì • ì¼€ì–´";
                recommendedProducts.push("ê·¹ì†ìƒ ëª¨ë°œìš© ì§‘ì¤‘ ì˜ì–‘ ë§ˆìŠ¤í¬");
                recommendedProducts.push("ê³ ë†ì¶• ë‹¨ë°±ì§ˆ ì„¸ëŸ¼");
            } else if (currentDamageLevel === 'moderate') {
                riskAssessment = "ëª¨ë°œ ì†ìƒë„ê°€ ë³´í†µì…ë‹ˆë‹¤. ì—¼ìƒ‰/íƒˆìƒ‰ì€ ì†ìƒë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìµœì†Œ 2ì£¼ í›„ ê¶Œì¥í•©ë‹ˆë‹¤. íŒ ì‹œìˆ ì€ ê°€ëŠ¥í•˜ë‚˜ ì»¬ ìœ ì§€ë ¥ì´ ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                possibleServices = "ì»·, ì¼ë°˜ íŒ (ì†ìƒ ëª¨ë°œìš© ì•½ì œ ì‚¬ìš©), ìˆ˜ë¶„ ì¼€ì–´";
                recommendedProducts.push("ë°ì¼ë¦¬ ì†ìƒ ì¼€ì–´ ìƒ´í‘¸ (pH ì•½ì‚°ì„±)");
                recommendedProducts.push("ìˆ˜ë¶„ ê³µê¸‰ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸");
            }
            // 'none' ë˜ëŠ” 'light'ì¼ ê²½ìš° ì´ˆê¸° riskAssessmentì™€ possibleServices ìœ ì§€

            if (scalpType === 'oily') {
                recommendedProducts.push("ì§€ì„± ë‘í”¼ ë”¥ í´ë Œì§• ìƒ´í‘¸");
            } else if (scalpType === 'dry') {
                recommendedProducts.push("ê±´ì„± ë‘í”¼ ë³´ìŠµ ì•°í”Œ");
            } else if (scalpType === 'sensitive') {
                recommendedProducts.push("ë¯¼ê° ë‘í”¼ ì§„ì • í† ë‹‰");
            }

            // ì‹œìˆ  ì´ë ¥ ê¸°ë°˜ ì œí’ˆ ì¶”ì²œ (ë°°ì—´ í¬í•¨ ì—¬ë¶€ ì²´í¬)
            if (services.includes('color') || services.includes('bleach')) {
                recommendedProducts.push("ì»¬ëŸ¬ ìœ ì§€ë ¥ í–¥ìƒ ìƒ´í‘¸");
            }
            if (services.includes('perm') || services.includes('straightening')) {
                recommendedProducts.push("ì»¬ íƒ„ë ¥ ê°•í™” ì—ì„¼ìŠ¤");
            }

            // ì‹œìˆ  ì ê¸° ì•ˆë‚´ (ë‹¨ìˆœí™”ëœ ëª¨ì˜)
            if (lastServiceDate) {
                const lastDate = new Date(lastServiceDate);
                const today = new Date();
                const diffTime = Math.abs(today - lastDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // í™”í•™ ì‹œìˆ  ì´ë ¥ì´ ìˆëŠ”ì§€ í™•ì¸
                const hasRecentChemical = services.some(s => ['perm', 'straightening', 'color', 'bleach'].includes(s));

                if (diffDays < 30 && hasRecentChemical) {
                    riskAssessment += ` (ë§ˆì§€ë§‰ ì‹œìˆ ì¼(${lastServiceDate})ë¡œë¶€í„° ${diffDays}ì¼ ê²½ê³¼. ê°€ë²¼ìš´ ì¼€ì–´ë§Œ ê¶Œì¥)`;
                } else if (diffDays >= 60 && currentDamageLevel !== 'severe' && (services.includes('color') || services.includes('perm'))) {
                     riskAssessment += ` (ì—¼ìƒ‰ ë˜ëŠ” íŒ ì‹œìˆ  ì ê¸°ê°€ ë‹¤ê°€ì™”ìŠµë‹ˆë‹¤. ì¬ë°©ë¬¸ì„ ìœ ë„í•˜ì„¸ìš”!)`;
                }
            }
            
            // ì œí’ˆ ì´ë¦„ ë°°ì—´ì„ ì „ì²´ ìƒì„¸ ì •ë³´ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜
            const fullRecommendedProducts = recommendedProducts.map(name => ({
                name,
                ...getProductDetails(name) // ì´ë¯¸ì§€ì™€ ê°€ê²© ì¶”ê°€
            }));


            return { riskAssessment, possibleServices, recommendedProducts: fullRecommendedProducts, damageLevel: currentDamageLevel };
        };

        // 3. ê¸°ë¡ ì €ì¥ í•¸ë“¤ëŸ¬ (ê¸°ì¡´ ë¡œì§ ìˆ˜ì •: ì €ì¥ í›„ CRM í˜ì´ì§€ë¡œ ì´ë™ ì¶”ê°€)
        document.getElementById('analysis-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUserId) {
                alertMessage('error', 'ì‚¬ìš©ì ì¸ì¦ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const clientName = clientNameInput.value.trim();
            const scalpType = scalpTypeInput.value;
            const damageLevelPlaceholder = 'none'; 
            
            const checkedServices = document.querySelectorAll('input[name="last-service-type"]:checked');
            const lastServiceTypes = Array.from(checkedServices).map(cb => cb.value);
            const lastServiceTypeData = lastServiceTypes.length > 0 ? lastServiceTypes : ['none'];


            const lastServiceDate = lastServiceDateInput.value;

            if (!clientName) {
                alertMessage('warning', 'ê³ ê°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // runAIDiagnosis í˜¸ì¶œ ë° ê²°ê³¼ ë¶„í•´
            const aiResults = runAIDiagnosis(clientName, scalpType, damageLevelPlaceholder, lastServiceTypeData, lastServiceDate);
            const { riskAssessment, possibleServices, recommendedProducts: fullRecommendedProducts, damageLevel: finalDamageLevel } = aiResults;

            // UIì— ê²°ê³¼ í‘œì‹œ (full product objects ì‚¬ìš©)
            displayDiagnosis(riskAssessment, possibleServices, fullRecommendedProducts, finalDamageLevel);

            const recordData = {
                clientName: clientName,
                timestamp: serverTimestamp(),
                diagnosis: {
                    scalpType,
                    damageLevel: finalDamageLevel, // ìµœì¢…ì ìœ¼ë¡œ ì¶”ë¡ ëœ ì†ìƒ ë ˆë²¨ ì €ì¥
                    lastServiceType: lastServiceTypeData, // ë°°ì—´ë¡œ ì €ì¥
                    lastServiceDate,
                    riskAssessment,
                    possibleServices
                },
                // Firestoreì—ëŠ” ì œí’ˆ ì´ë¦„(name)ë§Œ ì €ì¥
                recommendedProducts: fullRecommendedProducts.map(p => p.name), 
                userId: currentUserId 
            };

            try {
                await addDoc(getCollectionRef(currentUserId), recordData);
                alertMessage('success', `"${clientName}" ê³ ê°ì˜ ìƒíƒœ ë¶„ì„ ë° ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ê¸°ë¡ ì €ì¥ ì„±ê³µ í›„ ì¬ë°©ë¬¸ ìœ ë„ ë©”ì‹œì§€ë¥¼ ì¦‰ì‹œ ì‹œë®¬ë ˆì´ì…˜
                window.simulateReminder(finalDamageLevel);

                // *** ìˆ˜ì • ì‚¬í•­: ì €ì¥ í›„ ìë™ìœ¼ë¡œ ê¸°ë¡ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™ ***
                goToPage(2);

            } catch (error) {
                console.error("Firestore ì €ì¥ ì˜¤ë¥˜:", error);
                alertMessage('error', 'ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        });

        // 4. Firestore ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
        const setupFirestoreListener = (userId) => {
            const q = query(getCollectionRef(userId));
            
            onSnapshot(q, (snapshot) => {
                const records = [];
                snapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                // ì‹œê°„ ì—­ìˆœìœ¼ë¡œ ì •ë ¬ (ê°€ì¥ ìµœê·¼ ê¸°ë¡ì´ ìœ„ë¡œ)
                records.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                renderRecords(records);
            }, (error) => {
                console.error("Firestore ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                alertMessage('error', 'ê³ ê° ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        };

        // 5. UI ë Œë”ë§ í•¨ìˆ˜ (ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸)
        const renderRecords = (records) => {
            recordsList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
            if (records.length === 0) {
                recordsList.innerHTML = `<p class="text-center text-gray-500 py-4">ì•„ì§ ì €ì¥ëœ ê³ ê° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            records.forEach(record => {
                const date = record.timestamp ? new Date(record.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : 'ë‚ ì§œ ë¶ˆëª…';
                const productsText = record.recommendedProducts ? record.recommendedProducts.join(', ') : 'ì—†ìŒ';
                
                const recordEl = document.createElement('div');
                // ìŠ¤íƒ€ì¼ ë³€ê²½: ì§™ì€ ìƒ‰ìƒ í˜¸ë²„ ë° í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì¡°ì •
                recordEl.className = 'p-4 border-b border-gray-100 last:border-b-0 hover:bg-neutral-50 transition duration-150';
                recordEl.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-lg font-semibold text-primary">${record.clientName}</span>
                        <span class="text-sm text-gray-500">${date}</span>
                    </div>
                    <div class="text-sm text-gray-700 space-y-1">
                        <p><strong>ë‘í”¼/ì†ìƒë„:</strong> ${getScalpLabel(record.diagnosis.scalpType)} / <span class="text-accent-gold font-bold">${getDamageLabel(record.diagnosis.damageLevel)}</span></p>
                        <p><strong>ìµœê·¼ ì‹œìˆ :</strong> ${formatServiceList(record.diagnosis.lastServiceType)}</p>
                        <p><strong>AI ë¶„ì„:</strong> <span class="text-danger">${record.diagnosis.riskAssessment}</span></p>
                        <p><strong>ê°€ëŠ¥ ì‹œìˆ :</strong> ${record.diagnosis.possibleServices}</p>
                        <p><strong>ì¶”ì²œ ì œí’ˆ:</strong> ${productsText}</p>
                    </div>
                `;
                recordsList.appendChild(recordEl);
            });
        };

        // displayDiagnosis í•¨ìˆ˜ (ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸)
        const displayDiagnosis = (riskAssessment, possibleServices, recommendedProducts, damageLevel) => {
            const currentScalpType = scalpTypeInput.value;
            
            // 2. ê³ ê° ë°©ë¬¸ ì‹œ ì‹¤ì‹œê°„ ì‹œìˆ  ì•ˆë‚´
            diagnosisResult.innerHTML = `
                <div class="space-y-3">
                    <p class="text-gray-700"><strong>í˜„ì¬ ëª¨ë°œ/ë‘í”¼ ìƒíƒœ:</strong> ${getScalpLabel(currentScalpType)} ë‘í”¼, <span class="font-bold text-danger">${getDamageLabel(damageLevel)}</span> ëª¨ë°œ (AI ì¶”ë¡ )</p>
                    <div class="p-3 rounded-lg bg-red-50 border border-red-300">
                        <h4 class="font-bold text-red-700 mb-1">âš ï¸ AI ì‹œìˆ  ìœ„í—˜ì„± ë¶„ì„ ë° ì•ˆë‚´</h4>
                        <p class="text-sm text-red-600">${riskAssessment}</p>
                    </div>
                    <!-- ìŠ¤íƒ€ì¼ ë³€ê²½: ë„¤ì´ë¹„/ê³¨ë“œ ì ìš© -->
                    <div class="p-3 rounded-lg bg-info-subtle border border-accent-gold">
                        <h4 class="font-bold text-primary mb-1">âœ… AI ì¶”ì²œ ì‹œìˆ  ëª©ë¡ ë° ì‹œê¸°</h4>
                        <p class="text-sm text-gray-700">${possibleServices}</p>
                    </div>
                </div>
            `;

            // 3. AI ì¶”ì²œ í—¤ì–´ ì œí’ˆ ê¸°ëŠ¥ (ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸)
            recommendationList.innerHTML = `
                <h4 class="text-xl font-bold text-secondary mb-3">ğŸ›ï¸ AI ë§ì¶¤í˜• ì œí’ˆ ì²˜ë°©ì „</h4>
                <div class="space-y-4">
                    ${recommendedProducts.map(p => `
                        <div class="flex items-center space-x-4 p-4 bg-white border border-gray-200 rounded-xl shadow-lg transition duration-150 hover:border-accent-gold hover:shadow-xl">
                            <img src="${p.image}" alt="${p.name}" class="w-20 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-300" onerror="this.onerror=null; this.src='https://placehold.co/80x80/e5e5e5/999999?text=N/A';">
                            <div class="flex-grow">
                                <p class="text-base font-semibold text-gray-800">${p.name}</p>
                                <!-- ê°€ê²©ì— accent-gold ìƒ‰ìƒ ì ìš© -->
                                <p class="text-xl font-extrabold text-accent-gold mt-1">${p.price}</p>
                            </div>
                            <!-- ë²„íŠ¼ì— accent-gold ìƒ‰ìƒ ì ìš© -->
                            <button class="text-sm px-4 py-2 btn-gold rounded-full hover:shadow-md flex-shrink-0">êµ¬ë§¤ ë¬¸ì˜</button>
                        </div>
                    `).join('')}
                    ${recommendedProducts.length === 0 ? `<p class="text-sm text-gray-500 p-3">í˜„ì¬ ìƒíƒœì— ë§ëŠ” íŠ¹ë³„ ì¶”ì²œ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>` : ''}
                </div>
            `;
        };

        // 4. ë°©ë¬¸ í›„ ì¼€ì–´ ì•Œë¦¼ ë° ì¬ë°©ë¬¸ ìœ ë„ ë©”ì‹œì§€ ì‹œë®¬ë ˆì´ì…˜ (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
        window.simulateReminder = (damage) => {
            const clientName = clientNameInput.value.trim() || 'í…ŒìŠ¤íŠ¸ ê³ ê°';
            
            // í˜„ì¬ ì„ íƒëœ ì‹œìˆ  ë‚´ì—­ì„ ë°°ì—´ë¡œ ê°€ì ¸ì˜´
            const checkedServices = document.querySelectorAll('input[name="last-service-type"]:checked');
            const lastServiceTypes = Array.from(checkedServices).map(cb => cb.value);

            let message = '';

            if (damage === 'severe') {
                message = `${clientName}ë‹˜, ëª¨ë°œ ì†ìƒ íšŒë³µì„ ìœ„í•´ ${new Date().toLocaleDateString('ko-KR')} ë°©ë¬¸í•˜ì—¬ ì§‘ì¤‘ í´ë¦¬ë‹‰ì„ ë°›ì•„ë³´ì„¸ìš”!`;
            } else if (lastServiceTypes.includes('color')) {
                message = `${clientName}ë‹˜, ${new Date().toLocaleDateString('ko-KR')} ì—¼ìƒ‰ ìœ ì§€ ì‹œê¸°ê°€ ë‹¤ê°€ì™”ì–´ìš”. í™ˆì¼€ì–´ ì œí’ˆë„ í™•ì¸í•˜ì„¸ìš”!`;
            } else if (lastServiceTypes.includes('perm') || lastServiceTypes.includes('straightening')) {
                message = `${clientName}ë‹˜, íŒ ì‹œìˆ  í›„ 2ë‹¬ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. ì»¬ ìœ ì§€ë ¥ì´ ì•½í•´ì§€ê¸° ì „ì— ì¬ë°©ë¬¸í•˜ì—¬ í´ë¦¬ë‹‰ì„ ë°›ìœ¼ì„¸ìš”.`;
            } else {
                message = `${clientName}ë‹˜, ì§€ê¸ˆ ëª¨ë°œ ì†ìƒë„ê°€ íšŒë³µë˜ì–´ íŒ ì‹œìˆ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤! íŠ¹ë³„ í• ì¸ê³¼ í•¨ê»˜ ê´€ë¦¬ ì¼€ì–´ ë°›ìœ¼ì„¸ìš”!`;
            }

            reminderLog.innerHTML = `
                <!-- ìŠ¤íƒ€ì¼ ë³€ê²½: ê³¨ë“œ ë° ë„¤ì´ë¹„ ìƒ‰ìƒ ì ìš© -->
                <div class="mt-2 p-3 bg-yellow-50 border border-accent-gold rounded-xl text-sm text-primary shadow-md">
                    <p><strong>[ì•Œë¦¼ ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜]</strong></p>
                    <p>${message}</p>
                    <p class="text-xs mt-1 text-gray-600">ì‹¤ì œ ì‹œìŠ¤í…œì—ì„œëŠ” ë§¤ë‹¬ ìë™ ë°œì†¡ë˜ì–´ ì¬ë°©ë¬¸ìœ¨ì„ ë†’ì…ë‹ˆë‹¤.</p>
                </div>
            `;
            alertMessage('info', 'ì¬ë°©ë¬¸ ìœ ë„ ë©”ì‹œì§€ ë°œì†¡ì´ ì‹œë®¬ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
        };


        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
        const getScalpLabel = (value) => {
            switch (value) {
                case 'dry': return 'ê±´ì„±';
                case 'oily': return 'ì§€ì„±';
                case 'sensitive': return 'ë¯¼ê°ì„±';
                case 'composite': return 'ë³µí•©ì„±';
                default: return 'ë¯¸ì…ë ¥';
            }
        };

        const getDamageLabel = (value) => {
            switch (value) {
                case 'none': return 'ì†ìƒ ì—†ìŒ';
                case 'light': return 'ê²½ë¯¸í•œ ì†ìƒ';
                case 'moderate': return 'ë³´í†µ ì†ìƒ';
                case 'severe': return 'ì‹¬ê°í•œ ì†ìƒ';
                default: return 'ë¯¸ì…ë ¥';
            }
        };

        const getServiceLabel = (value) => {
            switch (value) {
                case 'cut': return 'ì»·';
                case 'perm': return 'íŒ (ì¼ë°˜)';
                case 'straightening': return 'ë§¤ì§/ìŠ¤íŠ¸ë ˆì´íŠ¸';
                case 'color': return 'ì—¼ìƒ‰';
                case 'bleach': return 'íƒˆìƒ‰';
                case 'clinic': return 'í´ë¦¬ë‹‰';
                case 'none':
                default: return 'ì—†ìŒ';
            }
        };

        const formatServiceList = (services) => {
            if (!services || services.length === 0 || (services.length === 1 && services[0] === 'none')) {
                return 'ì—†ìŒ';
            }
            // ë°°ì—´ì˜ ê° í•­ëª©ì„ í•œêµ­ì–´ ë ˆì´ë¸”ë¡œ ë³€í™˜ í›„, ì‰¼í‘œë¡œ ì—°ê²°
            return services.map(s => getServiceLabel(s)).join(', ');
        }


        const alertMessage = (type, message) => {
            const alerts = document.getElementById('alerts');
            const color = type === 'success' ? 'bg-primary' : type === 'error' ? 'bg-danger' : 'bg-blue-500';
            const alertEl = document.createElement('div');
            alertEl.className = `p-3 mb-2 text-sm text-white ${color} rounded-lg shadow-xl transition-opacity duration-300`;
            alertEl.textContent = message;
            alerts.prepend(alertEl);
            
            setTimeout(() => {
                alertEl.classList.add('opacity-0');
                alertEl.addEventListener('transitionend', () => alertEl.remove());
            }, 5000);
        };
        
        // 6. í™•ì¸ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ (ìˆ˜ì •ë¨: í™•ì¸ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ë³µê·€)
        window.handleRecordConfirmation = () => {
             alertMessage('success', 'ê³ ê° ê¸°ë¡ì„ í™•ì¸í•˜ê³  ì™„ë£Œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
             // TODO: ì‹¤ì œ ì•±ì—ì„œëŠ” ì´ í•¨ìˆ˜ ë‚´ì—ì„œ Firestoreì˜ ìƒíƒœ í•„ë“œ(ì˜ˆ: 'isReviewed: true')ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
             console.log("ê³ ê° ê¸°ë¡ í™•ì¸ ì™„ë£Œ (ì‹¤ì œ Firestore ì—…ë°ì´íŠ¸ ë¡œì§ í•„ìš”)");
             goToPage(1); // ë©”ì¸ ì…ë ¥ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
        };
    </script>

    <!-- UI ì˜ì—­ ì‹œì‘ -->
    <header class="mb-8">
        <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½: secondary (ì•„ì£¼ ì§™ì€ ë„¤ì´ë¹„) -->
        <h1 class="text-5xl font-extrabold text-secondary tracking-tight">PREMIUM SALON AI SYSTEM</h1>
        <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½: primary (ë”¥ ë„¤ì´ë¹„) -->
        <p class="mt-1 text-xl text-primary font-medium">ê³ ê° ëª¨ë°œ ìƒíƒœ ë¶„ì„ ë° ë§ì¶¤í˜• ì¼€ì–´ ì¶”ì²œ ì‹œìŠ¤í…œ</p>
        <div class="mt-3 text-sm text-gray-500">
            ë””ìì´ë„ˆ ID: <span id="user-id-display" class="font-mono text-sm bg-gray-200 px-2 py-1 rounded-lg">ë¡œë”© ì¤‘...</span>
        </div>
        <div id="alerts" class="mt-4 fixed top-4 right-4 z-50 w-64">
            <!-- ì•Œë¦¼ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
        </div>
    </header>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div id="loading-state" class="text-center py-20 text-xl font-semibold text-gray-500">
        ì‹œìŠ¤í…œ ë¡œë“œ ë° ì¸ì¦ ì¤‘ì…ë‹ˆë‹¤...
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ (relativeë¡œ ì„¤ì •í•˜ì—¬ absolute í˜ì´ì§€ë“¤ì„ ë‹´ìŒ) -->
    <div id="app-container" class="hidden relative">
        <!-- í˜ì´ì§€ 1: ì…ë ¥ ë° ì§„ë‹¨ ê²°ê³¼ (ê¸°ë³¸ í™”ë©´) -->
        <div id="page-main" class="page-content py-4 sm:py-8 min-h-[80vh] bg-body">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- 1. AI ê¸°ë°˜ ëª¨ë°œÂ·ë‘í”¼ ì§„ë‹¨ ì…ë ¥ í¼ (ì™¼ìª½ ì¹¼ëŸ¼) -->
                <div class="lg:col-span-1 card p-8">
                    <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ -->
                    <h2 class="text-2xl font-bold text-secondary mb-5 border-b pb-3 border-gray-100">1. ê³ ê° ìƒíƒœ ì…ë ¥ ë° AI ë¶„ì„ ìš”ì²­</h2>
                    
                    <form id="analysis-form" class="space-y-5">
                        <!-- ê³ ê°ëª… -->
                        <div>
                            <label for="client-name" class="block text-sm font-medium text-gray-700">ê³ ê°ëª… <span class="text-red-500">*</span></label>
                            <input type="text" id="client-name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent-gold focus:ring-accent-gold p-3 border">
                        </div>

                        <!-- ë‘í”¼ íƒ€ì… -->
                        <div>
                            <label for="scalp-type" class="block text-sm font-medium text-gray-700">ë‘í”¼ íƒ€ì…</label>
                            <select id="scalp-type" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent-gold focus:ring-accent-gold p-3 border">
                                <option value="dry">ê±´ì„±</option>
                                <option value="oily">ì§€ì„±</option>
                                <option value="sensitive">ë¯¼ê°ì„±</option>
                                <option value="composite">ë³µí•©ì„±</option>
                            </select>
                        </div>

                        <!-- ìµœê·¼ ì‹œìˆ  ì´ë ¥ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥í•œ ì²´í¬ë°•ìŠ¤ë¡œ ë³€ê²½) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ìµœê·¼ ì‹œìˆ  ë‚´ì—­ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                            <div id="last-service-type-container" class="space-y-1 flex flex-wrap gap-2">
                                <!-- ì²´í¬ë°•ìŠ¤ ìƒ‰ìƒ ë³€ê²½: primary ìƒ‰ìƒ ì ìš© -->
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="cut" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">ì»·</span>
                                </label>
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="perm" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">íŒ (ì¼ë°˜)</span>
                                </label>
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="straightening" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">ë§¤ì§/ìŠ¤íŠ¸ë ˆì´íŠ¸</span>
                                </label>
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="color" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">ì—¼ìƒ‰</span>
                                </label>
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="bleach" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">íƒˆìƒ‰</span>
                                </label>
                                <label class="inline-flex items-center p-2 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition duration-150 border">
                                    <input type="checkbox" name="last-service-type" value="clinic" class="rounded text-primary focus:ring-primary h-5 w-5">
                                    <span class="ml-2 text-sm text-gray-700">í´ë¦¬ë‹‰</span>
                                </label>
                            </div>
                        </div>

                        <!-- ë§ˆì§€ë§‰ ì‹œìˆ  ë‚ ì§œ -->
                        <div>
                            <label for="last-service-date" class="block text-sm font-medium text-gray-700">ë§ˆì§€ë§‰ ì‹œìˆ  ë‚ ì§œ</label>
                            <input type="date" id="last-service-date" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-accent-gold focus:ring-accent-gold p-3 border">
                        </div>
                        
                        <!-- ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½: primary (ë”¥ ë„¤ì´ë¹„) ì ìš© -->
                        <button type="submit" class="w-full py-3 px-4 border border-transparent rounded-xl shadow-lg text-lg font-medium text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-gold transition duration-150">
                            AI ë¶„ì„ ë° ê¸°ë¡ ì €ì¥ (ì €ì¥ í›„ 5ë²ˆ í˜ì´ì§€ë¡œ ì´ë™)
                        </button>
                    </form>

                    <!-- ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½: ê³¨ë“œ ì ìš© -->
                    <button onclick="simulateReminder('none')" class="w-full mt-4 py-2 px-4 border border-accent-gold rounded-xl text-sm font-medium text-primary bg-yellow-50 hover:bg-yellow-100 focus:outline-none transition duration-150">
                        4. ì¬ë°©ë¬¸ ìœ ë„ ë©”ì‹œì§€ ì‹œë®¬ë ˆì´ì…˜ (ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼)
                    </button>
                    
                    <!-- í˜ì´ì§€ ì´ë™ ë²„íŠ¼ (ë‹¤ìŒ í˜ì´ì§€ë¡œ) -->
                    <button onclick="goToPage(2)" class="w-full mt-6 py-3 px-4 rounded-xl text-lg font-medium text-white bg-accent-gold hover:bg-[#8C754D] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-gold transition duration-150">
                        â¡ï¸ ê¸°ë¡ ê´€ë¦¬ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™ (5ë²ˆ)
                    </button>
                </div>

                <!-- 2, 3. ì‹¤ì‹œê°„ ì‹œìˆ  ì•ˆë‚´ ë° ì œí’ˆ ì¶”ì²œ (ì¤‘ì•™ ì¹¼ëŸ¼) -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- 2. ì‹¤ì‹œê°„ ì‹œìˆ  ì•ˆë‚´ -->
                    <div class="card p-8">
                        <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ -->
                        <h2 class="text-2xl font-bold text-secondary mb-5 border-b pb-3 border-gray-100">2. ì‹¤ì‹œê°„ AI ì‹œìˆ  ì•ˆë‚´ ë° ìœ„í—˜ì„± ì§„ë‹¨</h2>
                        <div id="diagnosis-result" class="p-4 bg-info-subtle rounded-lg border border-gray-200">
                            <p class="text-gray-500">ğŸ‘† ì™¼ìª½ì— ê³ ê° ìƒíƒœë¥¼ ì…ë ¥í•˜ê³  'AI ë¶„ì„ ìš”ì²­' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>

                    <!-- 3. AI ì¶”ì²œ í—¤ì–´ ì œí’ˆ -->
                    <div class="card p-8">
                        <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ -->
                        <h2 class="text-2xl font-bold text-secondary mb-5 border-b pb-3 border-gray-100">3. AI ì¶”ì²œ í—¤ì–´ ì œí’ˆ ì²˜ë°©ì „ (ì œí’ˆ íŒë§¤ ì¦ëŒ€)</h2>
                        <div id="recommendation-list" class="p-4 bg-info-subtle rounded-lg border border-gray-200">
                            <p class="text-gray-500">AIê°€ ê³ ê° ìƒíƒœ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤í˜• ë¸Œëœë“œ ì œí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
                        </div>
                    </div>

                    <!-- 4. ì•Œë¦¼ ë¡œê·¸ -->
                    <div class="card p-8">
                        <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ -->
                        <h2 class="text-2xl font-bold text-secondary mb-5 border-b pb-3 border-gray-100">4. ì¼€ì–´ ì•Œë¦¼ ë° ì¬ë°©ë¬¸ ìœ ë„ ë©”ì‹œì§€ ë¡œê·¸</h2>
                        <div id="reminder-log" class="p-4 bg-info-subtle rounded-lg border border-gray-200">
                            <p class="text-gray-500">í•˜ë‹¨ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°œì†¡ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ 2: CRM ê³ ê° ê¸°ë¡ (ìˆ¨ê²¨ì§„ ìƒíƒœë¡œ ì‹œì‘) -->
        <div id="page-crm" class="page-content py-4 sm:py-8 bg-body">
             <div class="lg:col-span-3 card p-8 mb-8">
                <!-- í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ -->
                <h2 class="text-2xl font-bold text-secondary mb-5 border-b pb-3 border-gray-100">5. í—¤ì–´ìƒµ ë‚´ë¶€ ê³ ê° ê¸°ë¡ ìë™ ì •ë¦¬ (CRM)</h2>
                <div class="scroll-container bg-white border border-gray-200 rounded-xl">
                    <div id="records-list">
                        <!-- ê³ ê° ê¸°ë¡ì´ ì—¬ê¸°ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. -->
                        <p class="text-center text-gray-500 py-4">ê³ ê° ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
                
                <!-- === í™•ì¸ ë²„íŠ¼ (ìˆ˜ì •ë¨: ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°) === -->
                <button onclick="handleRecordConfirmation()" class="w-full mt-6 py-3 px-4 border border-transparent rounded-xl shadow-lg text-lg font-medium text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-gold transition duration-150">
                    ê¸°ë¡ í™•ì¸ ì™„ë£Œ (ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°)
                </button>
                
                 <!-- í˜ì´ì§€ ì´ë™ ë²„íŠ¼ (ì´ì „ í˜ì´ì§€ë¡œ) -->
                <button onclick="goToPage(1)" class="w-full mt-4 py-3 px-4 border border-gray-300 rounded-xl text-lg font-medium text-primary bg-white hover:bg-gray-100 focus:outline-none transition duration-150">
                    â¬…ï¸ ì…ë ¥/ì§„ë‹¨ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
            
            <!-- 6. í•˜ì´ì—”ë“œ ì‚´ë¡± ì •ë³´ ë° í‘¸í„° (CRM í˜ì´ì§€ì— í¬í•¨) -->
            <footer class="bg-secondary text-white mt-12 py-10">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 border-b border-gray-700 pb-8 mb-8">
                        
                        <!-- 1. ì‚´ë¡± ë¸Œëœë“œ ì •ë³´ -->
                        <div class="col-span-2 md:col-span-1">
                            <h5 class="text-2xl font-extrabold mb-4 text-accent-gold">LUXURY HAIR SALON</h5>
                            <p class="text-gray-400 text-sm">
                                ìµœê³ ê¸‰ ì„œë¹„ìŠ¤ì™€ AI ì§„ë‹¨ ê¸°ìˆ ì´ ê²°í•©ëœ í•˜ì´ì—”ë“œ í—¤ì–´ ì‚´ë¡±ì…ë‹ˆë‹¤. ê³ ê° í•œ ë¶„ í•œ ë¶„ì—ê²Œ ì™„ë²½í•œ ìŠ¤íƒ€ì¼ê³¼ ì¼€ì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                            </p>
                        </div>
                        
                        <!-- 2. ê³ ê°ì„¼í„° / ì „í™”ë²ˆí˜¸ -->
                        <div>
                            <h5 class="text-lg font-semibold mb-4 text-gray-200">ê³ ê°ì„¼í„° / ì˜ˆì•½ ë¬¸ì˜</h5>
                            <p class="text-accent-gold text-2xl font-bold mb-2">
                                02-1234-5678
                            </p>
                            <p class="text-gray-400 text-sm">
                                ìš´ì˜ ì‹œê°„: 10:00 - 20:00<br>
                                (ë§¤ì£¼ ì›”ìš”ì¼ ì •ê¸° íœ´ë¬´)
                            </p>
                        </div>

                        <!-- 3. ì˜¤ì‹œëŠ” ê¸¸ / ì£¼ì†Œ -->
                        <div>
                            <h5 class="text-lg font-semibold mb-4 text-gray-200">ì˜¤ì‹œëŠ” ê¸¸ (Address)</h5>
                            <p class="text-gray-400 text-sm">
                                ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123, 1ì¸µ<br>
                                (ê°•ë‚¨ì—­ 1ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„)
                            </p>
                            <a href="#" class="mt-2 inline-block text-sm text-accent-gold hover:text-white transition duration-200 underline">
                                [ìì„¸í•œ ì§€ë„ ë³´ê¸°]
                            </a>
                        </div>
                        
                        <!-- 4. ìì£¼ ì°¾ëŠ” ë§í¬ -->
                        <div>
                            <h5 class="text-lg font-semibold mb-4 text-gray-200">Quick Links</h5>
                            <ul class="space-y-2">
                                <li><a href="#" class="text-gray-400 hover:text-accent-gold transition duration-200 text-sm">ì‚´ë¡± ì†Œê°œ</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-accent-gold transition duration-200 text-sm">ê°€ê²©í‘œ ë° ì„œë¹„ìŠ¤</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-accent-gold transition duration-200 text-sm">ì˜¨ë¼ì¸ ì˜ˆì•½</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- ì €ì‘ê¶Œ -->
                    <div class="text-center text-sm text-gray-500">
                        &copy; 2024 LUXURY HAIR SALON. Powered by AI Care System. All rights reserved.
                    </div>
                </div>
            </footer>
        </div>
    </div>
</body>
</html>
